@startuml pipeline_state_diagram
skinparam state {
    BackgroundColor lightblue
    BorderColor black
    FontSize 11
}

[*] --> Uninitialized

state Uninitialized {
    [*] --> Ready
    Ready : Configuration loaded
    Ready : Memory pools created
    Ready : Thread pools initialized
}

Uninitialized --> Initializing : configure()
Initializing --> Active : initialization_complete()
Initializing --> Error : initialization_failed()

state Active {
    [*] --> Idle
    
    state Processing {
        [*] --> Reading
        Reading --> Chunking : file_opened
        Chunking --> StageProcessing : chunks_created
        
        state StageProcessing {
            [*] --> Compression
            Compression --> Encryption : compression_complete
            Encryption --> Integrity : encryption_complete
            Integrity --> Writing : integrity_complete
        }
        
        Writing --> Completed : all_chunks_written
        StageProcessing --> Retrying : stage_error
        Retrying --> StageProcessing : retry_attempt
        Retrying --> Failed : max_retries_exceeded
    }
    
    Idle --> Processing : process_file()
    Processing --> Idle : processing_complete()
    Processing --> Paused : pause_signal()
    Paused --> Processing : resume_signal()
    Processing --> Recovering : checkpoint_restore()
    Recovering --> Processing : recovery_complete()
}

Active --> Shutting : shutdown_signal()
Error --> Shutting : recovery_failed()

state Shutting {
    [*] --> ClosingFiles
    ClosingFiles --> ReleasingResources : files_closed
    ReleasingResources --> Stopped : resources_released
}

Shutting --> [*] : shutdown_complete()
Error --> [*] : error_handled()

note right of Processing : "Main processing state\nwith error recovery"
note bottom of Shutting : "Graceful shutdown\nwith resource cleanup"

@enduml